{% extends "base.html" %}

{% block main %}

    <div class="user-info">
        Logged in as: {{ current_user.username }}
    </div>

    <div class="alert-wrapper">
        <div id="success" class="alert alert-success hide">
            Something
        </div>
    </div>

    <form class="admin-form" id="admin-form" method="post">
        <table class="table table-bordered table-striped">
            <thead>
            <tr>
                <th>User</th>
                <th>Approver</th>
                <th>Admin</th>
            </tr>
            </thead>
            <tbody>
            {% if users %}
                {% for user in users %}
                    <tr>
                        <td>{{ user.username }}</td>
                        <td>{{ user.is_approver }}</td>
                        <td>{{ user.is_admin }}</td>
                    </tr>
                {% endfor %}
            {% endif %}
            </tbody>
        </table>
        <input type="submit" value="Submit" class="btn btn-primary btn-large pull-right">
    </form>

{% endblock %}

{% block js %}

    <script>
        $(document).ready(function() {
            var button;
            var timeout;
            var success_alert;
            $('.btn-approve').click(function() {
                button = $(this)
                success_alert = $('#success')
                $.post("{{ url_for('approve') }}", {'id': $(this).attr('id'), 'approver': "{{ username }}"},
                        function(responseData) {
                            clearTimeout(timeout)
                            if (responseData) {
                                success_alert.html('Time record approved by ' + responseData)
                                button.parent().html(responseData)
                            }
                            $('#success').fadeIn();
                            timeout = setTimeout(function() {$('#success').fadeOut()}, 3000);
                        });
            });
        });

    </script>

{% endblock %}